@{
    ViewData["Title"] = "Sender filer til FTP Server";
}

<div class="row">
    <div class="col-md-6 offset-md-3">
        <h4>@ViewData["Title"]</h4>

        <p><strong><span id="job-status"></span></strong></p>

        <div id="progress" class="progress">
            <div class="progress-bar progress-bar-striped progress-bar-animated text-center" role="progressbar" style="width: 0%;"><span id="progressLabel"></span></div>
        </div>

        <p><span id="speed"></span> - <span id="bytesSend"></span></p>
    </div>
</div>



@section Scripts
{
    <script src="~/js/signalr/dist/browser/signalr.js"></script>
    <script>
        var connection = new signalR.HubConnectionBuilder()
            .withUrl("/ftpProgressHub")
            .configureLogging(signalR.LogLevel.Information)
            .build();
        connection.on("progress", function (percent, status, speedLabel, byte) {
            document.getElementById("job-status").innerText = `${status}`;

            $('#progress .progress-bar').css(
                'width',
                percent + '%'
            );

            var dataLabel;
            var dataSend = (byte / 1024).toFixed(2);
            if (dataSend >= 1024) {
                dataLabel = `${(dataSend / 1024).toFixed(2)} MB`;
            }
            else {
                dataLabel = `${dataSend} KB`
            }

            document.getElementById("progressLabel").innerText = `${percent.toFixed(2)}%`;
            document.getElementById("speed").innerText = `${speedLabel}`;
            document.getElementById("bytesSend").innerText = `${dataLabel}`;
        });
        connection.start()
            .then(_ => connection.invoke("AssociateJob", "@ViewBag.JobId"))
            .catch(err => console.error(err.toString()));
    </script>
}